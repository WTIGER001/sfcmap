<div class="white">
  <h1>Markers</h1>

  <div class="buttonbar">
    <button class="btn btn-outline-secondary btn-tool" (click)="newMarker()" placement="bottom" ngbTooltip="Create a new marker">
      <fa-icon icon="plus" size="lg"></fa-icon>
    </button>
    <button *ngIf="!selection.isEmpty()" class="btn btn-outline-secondary btn-tool" (click)="editstart()" placement="bottom"
      ngbTooltip="Edit the selected marker(s)">
      <fa-icon icon="pencil-alt" size="lg"></fa-icon>
    </button>
    <button *ngIf="!selection.isEmpty()" class="btn btn-outline-secondary btn-tool" (click)="permissions()" placement="bottom"
      ngbTooltip="Set the access permissions">
      <fa-icon *ngIf="restricted == true" icon="lock" size="lg" class="lockbtn"></fa-icon>
      <fa-icon *ngIf="restricted == false" icon="unlock" size="lg"></fa-icon>
    </button>
    <button *ngIf="!selection.isEmpty()" class="btn btn-outline-secondary btn-tool" (click)="delete()" placement="bottom" ngbTooltip="Delete the selected marker(s)">
      <fa-icon icon="trash-alt" size="lg"></fa-icon>
    </button>
  </div>

  <div class="scroller scroller-dark marker-scroll">
    <ng-container *ngIf="!edit">
      <div class="marker-container" *ngFor="let marker of selection.items">
        <img [src]="marker?.iconUrl" height="50" class="centered mt-2 iconselected">
        <h3>{{marker?.name}}</h3>
        <span *ngIf="marker.markerGroup" class="type">{{name(marker)}}</span>
        <a href="#" class="coords" (click)="pan()">{{coords(marker)}}</a>
        <a *ngIf="marker.pageUrl" [href]="marker.pageurl" target="_blank">
          <fa-icon icon="globe"></fa-icon> Open Web Link</a>
        <a *ngIf="marker.mapLink" href="#" (click)="openLinkedMap()">
          <fa-icon icon="map"></fa-icon> Open Linked Map</a>
        <app-readmore class="text-muted mb-2 description" *ngIf="marker.description" [value]="marker.description"></app-readmore>
      </div>
    </ng-container>
    <!-- Edit of a single marker -->
    <div *ngIf="edit && selection.items.length==1">
      <img [src]="marker?.iconUrl" class="centered mt-4 iconselected">
      <div class="form-group">
        <label for="name" class="small">Name</label>
        <input type="text" class="form-control form-control-sm" id="name" placeholder="Enter Marker Name" [(ngModel)]="marker.name">
      </div>
      <div class="form-group">
        <label for="type" class="small">Type</label>
        <app-marker-combo [(ngModel)]="marker.type" [map]="map"></app-marker-combo>
      </div>
      <div class="form-group">
        <label for="type" class="small">Group</label>
        <app-marker-group-combo [(ngModel)]="marker.markerGroup" [marker]="marker"></app-marker-group-combo>
      </div>
      <div class="form-group">
        <label for="mapLink" class="small">Map Link</label>
        <select class="form-control" id="mapLink" [(ngModel)]="marker.mapLink">
          <optgroup *ngFor="let mt of merged" [label]="mt.name">
            <option *ngFor="let map of mt.maps" [value]="map.id">{{map.name}}</option>
          </optgroup>
        </select>
      </div>
      <div class="form-group">
        <label for="description" class="small">Description</label>
        <textarea class="form-control form-control-sm" rows="3" id="description" placeholder="Enter Description" [(ngModel)]="marker.description"></textarea>
      </div>
      <div class="buttonbar">
        <button type="button" class="btn btn-outline-secondary btn-tool" aria-label="Close" (click)="save()">
          <fa-icon icon="save" size="lg"></fa-icon> Save
        </button>
        <button type="button" class="btn btn-outline-secondary btn-tool" aria-label="Close" (click)="cancel()">
          <fa-icon icon="times" size="lg"></fa-icon> Cancel
        </button>
      </div>
    </div>

    <!-- Edit of multiple markers -->
    <div *ngIf="edit && selection.items.length > 1">
      <div class="form-group">
        <label for="type" class="small">Type</label>
        <app-marker-combo [(ngModel)]="markers.type" [map]="map" (change)="updateMuliEdit()"></app-marker-combo>
      </div>
      <div class="form-group">
        <label for="type" class="small">Group</label>
        <app-marker-group-combo [(ngModel)]="markers.markerGroup" [marker]="markers" (change)="updateMuliEdit()"></app-marker-group-combo>
      </div>
      <div class="buttonbar">
        <button type="button" class="btn btn-outline-secondary btn-tool" aria-label="Close" (click)="save()">
          <fa-icon icon="save" size="lg"></fa-icon> Save
        </button>
        <button type="button" class="btn btn-outline-secondary btn-tool" aria-label="Close" (click)="cancel()">
          <fa-icon icon="times" size="lg"></fa-icon> Cancel
        </button>
      </div>
    </div>
  </div>
</div>